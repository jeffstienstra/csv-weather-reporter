# SpinDance Setup:

## Prerequisites

1. Setup github command line tool [hub](https://github.com/github/hub)

## Setup Challenger AWS Account (one time per account):

### Register a new Thing in the challenge account:
1. Login to the AWS console with your provided credentials. You may be prompted to reset your password on login.
1. Select the 'US East (N. Virginia)' region in the upper left corner of the console
1. Under the 'Services' dropdown, navigate to ‘AWS IoT Core'
1. Select ‘Secure’->’Policies' from the left hand navigation menu.
1. Select ‘Create’ and give your policy a name you will recognize
1. Click on ‘Advanced mode’ in the ‘Add statements section, and copy the following policy into the edit view.
    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Action": [
            "iot:Connect"
          ],
          "Resource": [
            "arn:aws:iot:*:*:client/ConnectedSensor"
          ]
        },
        {
          "Effect": "Allow",
          "Action": [
            "iot:Publish",
            "iot:Receive"
          ],
          "Resource": [
            "arn:aws:iot:*:*:topic/$aws/*",
            "arn:aws:iot:*:*:topic/*"
          ]
        },
        {
          "Effect": "Allow",
          "Action": [
            "iot:Subscribe"
          ],
          "Resource": [
            "arn:aws:iot:*:*:topicfilter/$aws/*",
            "arn:aws:iot:*:*:topicfilter/*"
          ]
        }
      ]
    }
    ```
1. Click on ‘Create’ to create the policy
1. Navigate back to 'AWS IoT Core', and select ‘Manage’ on the left hand navigation menu, and ‘Create’ to create a new Thing
1. Create a single ‘Thing’ using the name `ConnectedSensor`, and create without any need for Groups / Types / Attributes
1. Select ‘Create certificate’ to generate a new certificate for your thing.
1. Once generated, download the four files: the certificate, the public key, the private key, and the CA cert. Put these under the appropriate folder for the account under the [.backup-aws-accounts-data](../../.backup-aws-accounts-data)
1. Select ‘Activate’ followed by “Attach a Policy"
1. Select the policy created in the previous steps, followed by “Register Thing"
1. That’s it! You know have a registered thing an AWS IoT, as well as the Certificates and Keys needed to make the connection.
1. If you run into any issues, refer to [this article](https://docs.aws.amazon.com/iot/latest/developerguide/register-device.html) for registering a Device in AWS IoT.

### Create the IAM Group for the Challenger Users
1. Login to the AWS challenge account
1. Navigate to IAM
1. Select 'Groups'->'Create New Group' and 'next'
1. Add the following policies:
    `AWSIoTFullAccess`
    `CloudWatchReadOnlyAccess`
    `CloudWatchLogsReadOnlyAccess`
    `CloudWatchEventsReadOnlyAccess`
1. Select 'Next'->'Create Group'

## Setup the Challenger User

### Create an IAM User for the candidate
1. Login to the AWS challenge account
1. Navigate to IAM
1. Create a new User, selecting both Programmatic and Console Access. Leave selected the autogenerated password that must be reset.
1. Add them to the 'CodeChallengers' group
1. Once the user is created, dowload the 'credentials.csv' file at the success screen and attach to the email in the next section

### Initiate the Challenge

1. On the agreed time, copy this repository to a new repository with the candidates name appended:
    ```
    git clone git@github.com:spindance/spindance.code-challenge
    cp -r spindance.code-challenge spindance.code-challenge.<candidate-id>
    cd spindance.code-challenge.<candidate-id>
    hub create spindance.code-challenge.<candidate-id>
    git remote set-url origin git@github.com:spindance/spindance.code-challenge.<candidate-id>
    git push origin master
    ```
1. Copy the internal files for the challenge account the candidate is using the following commands. 
This shows an example using data specific to the 'spindance-codechallenge2' account.
    ```
    cd <repo root>
    rm -r certificates
    cp -r .spindance-internal-only/spindance-codechallenge2/* .
    ```
1. Remove the internals directory (no real sensitive data here, but this helps with distraction)
    ```
    cd <repo root>
    rm -r .spindance-internal-only
    ```
1. Commit and push the changes
    ```
    git checkout master
    git add *
    git add .spindance-internal-only/
    git commit -m "configure for <candidate-id>"
    git push master
    ```
1. Attach the csv credentials file ans send the following email to the candidate

    ```
    Subject: SpinDance Code Challenge: Good Luck!
    
    Hi <Candidate Name> - 
    
    We are excited to kick you off on the SpinDance code challenge. 

    You will need access to Amazon Web Services (AWS) to complete the challenge. Attached is a CSV file containing the AWS sign-in url, username, and password. You will be forced to reset your password on your first login. The CSV also contains the values for your Access Key ID and Secret Access Key. You will not need these for this challenge. Please confirm you can log into the console and let us know if there are any issues as soon as possible.

    You will receive an email notification shortly from github with a link to the code challenge repository.  Read through the instructions and feel free to get started at any time. We ask that you complete your last commits no later than <end date time>. Please let me know if you have any access issues, or need clarifications.
    
    
    Thank you,
    ```
 1. Give the candidate access via their provided github id (Have Bruce fill in details here)

   1. Navigate to the repository and select "Settings" 
   1. Pick "Collaborators and teams"  
   1. Under the "Collaborators" section, add the candidate's github id and select "Add collaborator"

 ### Cleanup 
 
 1. The candidate copy of the repo should be kept until a hiring decision has been made. Once this 
 is done, archive the repo by creating a zip file and storing it in a Google Drive folder: https://drive.google.com/drive/folders/10pBfVMUwhgBv0QnDUAP_0olXyewEEx8M.
    1. Clone the repo: `git clone git@github.com:spindance/spindance.code-challenge.<candidate_id>.git`
    1. Change directory to the repo root.
    1. Archive to tar.gz archive: `git archive HEAD | gzip > /tmp/spindance.code-challenge.<candidate_id>.tar.gz`
    1. Upload to the shared folder
 1. Delete the private repository for the candidate
