# SpinDance Setup:

## Setup Challenger AWS Account (one time per account):

### Register a new Thing in the challenge account:
1. Login to the AWS console with your provided credentials. You may be prompted to reset your password on login.
1. Select the 'US East (N. Virginia)' region in the upper left corner of the console
1. Under the 'Services' dropdown, navigate to ‘AWS IoT Core'
1. Select ‘Secure’->’Policies' from the left hand navigation menu.
1. Select ‘Create’ and give your policy a name you will recognize
1. Click on ‘Advanced mode’ in the ‘Add statements section, and copy the following policy into the edit view.
    ```json
    {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": [
          "iot:Connect"
        ],
        "Resource": [
          "arn:aws:iot:us-east-2:*:client/ConnectedSensor"
        ]
      },
      {
        "Effect": "Allow",
        "Action": [
          "iot:Publish",
          "iot:Receive"
        ],
        "Resource": [
          "arn:aws:iot:us-east-2:*:topic/$aws/things/ConnectedSensor/*",
          "arn:aws:iot:us-east-2:*:topic/things/ConnectedSensor/readings",
          "arn:aws:iot:us-east-2:*:topic/things/ConnectedSensor/diagnostics"
        ]
      },
      {
        "Effect": "Allow",
        "Action": [
          "iot:Subscribe"
        ],
        "Resource": [
          "arn:aws:iot:us-east-2:*:topicfilter/$aws/things/ConnectedSensor/shadow/*",
          "arn:aws:iot:us-east-2:*:topicfilter/things/ConnectedSensor/readings",
          "arn:aws:iot:us-east-2:*:topicfilter/things/ConnectedSensor/diagnostics"
        ]
      }
    ]
    }
    ```
1. Click on ‘Create’ to create the policy
1. Navigate back to 'AWS IoT Core', and select ‘Manage’ on the left hand navigation menu, and ‘Create’ to create a new Thing
1. Create a single ‘Thing’ using the name `ConnectedSensor`, and create without any need for Groups / Types / Attributes
1. Select ‘Create certificate’ to generate a new certificate for your thing.
1. Once generated, download the four files: the certificate, the public key, the private key, and the CA cert. Put these under the appropriate folder for the account under the [.backup-aws-accounts-data](../../.backup-aws-accounts-data)
1. Select ‘Activate’ followed by “Attach a Policy"
1. Select the policy created in the previous steps, followed by “Register Thing"
1. That’s it! You know have a registered thing an AWS IoT, as well as the Certificates and Keys needed to make the connection.
1. If you run into any issues, refer to [this article](https://docs.aws.amazon.com/iot/latest/developerguide/register-device.html) for registering a Device in AWS IoT.

### Create the IAM Group for the Challenger Users
1. Login to the AWS challenge account
1. Navigate to IAM
1. Select 'Groups'->'Create New Group' and 'next'
1. Add the following policies:
    `AWSIoTFullAccess`
    `CloudWatchReadOnlyAccess`
    `CloudWatchLogsReadOnlyAccess`
    `CloudWatchEventsReadOnlyAccess`
1. Select 'Next'->'Create Group'

## Setup the Challenger User

### Create an IAM User for the candidate
1. Login to the AWS challenge account
1. Navigate to IAM
1. Create a new User, selecting both Programmatic and Console Access. Leave selected the autogenerated password that must be reset.
1. Add them to the 'CodeChallengers' group
1. Once the user is created, dowload the 'credentials.csv' file at the success screen and attach to the email in the next section

### Send Candidate Email
Send the challenger an email with a similar body/subject to establish timing of the challenge and provide AWS credentials

```
Subject: SpinDance Code Challenge: AWS Credentials and GitHub ID

Hi <Candidate Name> - 

We are getting setup for the code challenge. Today I’m sending you some AWS credentials to at least try and login with. I want to be sure we have that working before we proceed. Next, we need to know a ~3 day period that would work for you to start the challenge. I will suggest Friday 5pm to Monday 9am seems to be good for most folks since it gives plenty of time to complete, and still has flexibility with what you may already have planned. Does this time work for you? Is there a better time period?
Attached is a CSV file containing the sign-in url, username, and password to sign in. You will be forced to reset your password on your first login. The CSV also contains the values for your Access Key ID and Secret Access Key. You should not need these for this particular challenge.

We will also need to know your github ID. Please include that in the reply to this email. If you don't yet have an account, please sign up for a free account.

Please let me know about timing of the challenge as well as confirm you can login with your AWS credentials

Thank you,
```

### Initiate the Challenge

1. On the agreed time, copy this repository to a new repository with the candidates name appended:
    ```
    git clone git@github.com:<user>/spindance.code-challenge
    cd spindance.code-challenge
    git remote set-url origin git@github.com:<user>/spindance.code-challenge.<candidate-id>
    git push origin master
    ```
1. Copy the internal files for the challenge account the candidate is using:
    ```
    cd <repo root>
    cp -r .spindance-internal-only/<spindance-codechallenge-account-name> .
    ```
1. Remove the internals directory (no real sensitive data here, but this helps with distraction)
    ```
    cd <repo root>
    rm -r .spindance-internal-only
    ```
1. Commit and push the changes
    ```
    git checkout master
    git add *
    git commit -m "configure for <candidate-id>"
    git push master
    ```
1. Send the following email to the candidate

    ```
    Subject: SpinDance Code Challenge: Good Luck!
    
    Hi <Candidate Name> - 
    
    We are excited to kick you off on the SpinDance code challenge. 
    You will receive an email notification shortly from github with a link to the code challenge repository.
    Read through the instructions and feel free to get started at any time. We ask that you complete your last commits
    no later than <end date time>. Please let me know if you have any access issues, or need clarifications.
    
    
    Thank you,
    ```
 1. Give the candidate access via their provided github id (Have Bruce fill in details here)